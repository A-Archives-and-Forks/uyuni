SATELLITE_HOST="satellite.suse.de"
SATELLITE_DB_USER="rhnsat"
SATELLITE_DB_PASS="rhnsat"
SATELLITE_DB_SID="rhnsat"

$> # empty database, create tablespace
$> /usr/sbin/spacewalk-service stop
$> /etc/init.d/oracle-xe start
$> sqlplus 'sys@xe as sysdba'
drop user spacewalk cascade;
create smallfile tablespace data_tbs datafile '/usr/lib/oracle/xe/oradata/XE/data_01.dbf' SIZE 3800M;
create user spacewalk identified by spacewalk default tablespace data_tbs;
grant dba to spacewalk;
quit;

$> # prepare remote dump
$> echo "rrxe =
  (DESCRIPTION =
    (ADDRESS_LIST =
      (ADDRESS = (PROTOCOL = TCP)(HOST = $SATELLITE_HOST)(PORT = 1521))
    )
    (CONNECT_DATA =
      (SID = $SATELLITE_DB_SID)
    )
  )
" >> /etc/tnsnames.ora

$> # dump remote DB, import into local DB and do a schema-upgrade
$> su - oracle
$> SATELLITE_HOST="satellite.suse.de"
$> SATELLITE_DB_USER="rhnsat"
$> SATELLITE_DB_PASS="rhnsat"
$> exp $SATELLITE_DB_USER/$SATELLITE_DB_PASS@rrxe owner=$SATELLITE_DB_USER consistent=y statistics=none file=/tmp/sat.oracleXE.dmp log=/tmp/rhn.oracleXE.log
$> ORACLE_SID=XE; export ORACLE_SID
$> imp \'/ as sysdba\' fromuser=$SATELLITE_DB_USER touser=spacewalk file=/tmp/sat.oracleXE.dmp log=/tmp/spacewalk.oracleXE.imp.log ignore=y
$> exit
$> spacewalk-schema-upgrade



$> rsync -avz $SATELLITE_HOST:/var/satellite/ /var/satellite/

maybe add -H for hardlinks? 

$> chown -R wwwrun.www /var/satellite

$> rsync -a -v -z --ignore-existing $SATELLITE_HOST:/var/lib/cobbler/ /var/lib/cobbler/

copy only new files (new kickstart profiles, snippets, trigger, etc.)

$> /etc/init.d/cobblerd restart
$> cobbler sync

To create the install tree


$> mkdir -p /root/backup/pub
$> mkdir -p /root/backup/ssl/jabberd
$> mv /srv/www/html/pub/RHN-ORG-TRUSTED-SSL-CERT /root/backup/pub/
$> mv /srv/www/html/pub/rhn-org-trusted-ssl-cert*.rpm /root/backup/pub/
$> mv /root/ssl-build /root/backup/
$> cp /etc/apache2/ssl.crt/spacewalk.crt /root/backup/ssl/
$> cp /etc/apache2/ssl.key/spacewalk.key /root/backup/ssl/
$> cp /etc/pki/spacewalk/jabberd/server.pem /root/backup/ssl/jabberd/

$> rsync -avz --ignore-existing $SATELLITE_HOST:/var/www/html/pub/ /srv/www/html/pub/
$> rsync -avz $SATELLITE_HOST:/root/ssl-build /root/



Copy the webserver cert and key from satellite to Manager
On satellite look at /etc/httpd/conf.d/ssl.conf for the keys
SSLCertificateFile and SSLCertificateKeyFile

Copy the files given files to the Manager server to 
SSLCertificateFile => /etc/apache2/ssl.crt/spacewalk.crt
SSLCertificateFile => /etc/pki/spacewalk/jabberd/server.pem
SSLCertificateKeyFile => /etc/apache2/ssl.key/spacewalk.key

The SUSE Manager server needs to have the same hostname as the 
old satellite server. 
Reboot now to get the new hostname.


